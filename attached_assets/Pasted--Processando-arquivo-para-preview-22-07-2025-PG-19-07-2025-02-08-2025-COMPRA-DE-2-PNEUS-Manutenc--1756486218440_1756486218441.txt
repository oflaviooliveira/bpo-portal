ğŸ” Processando arquivo para preview: 22.07.2025_PG_19.07.2025_02.08.2025_COMPRA DE 2 PNEUS_ManutencÃŒÂ§aÃŒo de Veiculos_SRJ1_R$1.450,00.pdf
ğŸ“„ Iniciando extraÃ§Ã£o de texto PDF: uploads/3b3407ce0546d584ca4300becd657ed8
Warning: Indexing all PDF objects
âœ… ExtraÃ§Ã£o nativa bem-sucedida: 2342 caracteres
ğŸ¤– Analisando documento com IA: 22.07.2025_PG_19.07.2025_02.08.2025_COMPRA DE 2 PNEUS_ManutencÃŒÂ§aÃŒo de Veiculos_SRJ1_R$1.450,00.pdf
ğŸ“ Texto extraÃ­do (2342 chars): DANFE
Documento Auxiliar da 
Nota Fiscal EletrÃ´nica
AV MARIA DO CARMO, 1571
POSTO LAVA TUCUNS
CRUZ / CE
62595-000
(88) 9729-5739 - 
0 - ENTRADA
1 - SAÃDA
CHAVE DE ACESSO
NÂº 645   
SÃ©rie 1 
Consulta de...
ğŸ“‹ Detectada nota fiscal - usando analisador especializado
ğŸ”„ Usando AI Multi-Provider para anÃ¡lise...
ğŸ“‹ Documento classificado como: DANFE (57.5% confianÃ§a)
ğŸ” Indicadores: Keyword: DANFE, Keyword: Nota Fiscal EletrÃ´nica, Keyword: CNPJ, Keyword: Chave de Acesso, Keyword: ICMS, Keyword: CFOP, Keyword: NCM, Pattern: \d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}
ğŸ“‹ Documento complexo detectado (DANFE) - priorizando OpenAI
ğŸ¤– Tentando anÃ¡lise com openai...
ğŸ”— OpenAI API Request - Model: gpt-4o-mini
ğŸ’° OpenAI Expected Cost: $0.375/1k tokens
ğŸ¤– OpenAI Response (gpt-4o-mini): {
  "valor": "R$ 1.450,00",
  "fornecedor": "ROBSON PNEUS E AUTOPECAS LTDA",
  "cnpj_emitente": "95.001.834/0001-34",
  "data_emissao": "19/07/2025",
  "data_saida": "19/07/2025",
  "data_vencimento": null,
  "descricao": "ManutenÃ§Ã£o de VeÃ­culos SRJ1 - Compra de 2 Pneus",
  "categoria": "PAGO",
  "documento": "NÂº 645 SÃ©rie 1",
  "confidence": 0.95
}
âš ï¸ Schema validation strict failed for openai, trying flexible validation...
ğŸ”§ GLM response auto-corrected: {
  valor: 'R$ 1.450,00',
  fornecedor: 'ROBSON PNEUS E AUTOPECAS LTDA',
  cnpj_emitente: '95.001.834/0001-34',
  data_emissao: '19/07/2025',
  data_saida: '19/07/2025',
  descricao: 'ManutenÃ§Ã£o de VeÃ­culos SRJ1 - Compra de 2 Pneus',
  categoria: 'PAGO',
  documento: 'NÂº 645 SÃ©rie 1',
  confidence: 95,
  centro_custo: 'GERAL'
}
âœ… Provider openai response auto-corrected successfully
âœ… Provider openai marked as ONLINE after successful analysis
ğŸ“Š Stats atualizadas para openai: 1 requests, 100.0% sucesso
ğŸ” ValidaÃ§Ã£o: ERROR (60/100)
ğŸ“‹ ClassificaÃ§Ã£o: DANFE (57.5% confianÃ§a)
ğŸ” Indicadores: Keyword: DANFE, Keyword: Nota Fiscal EletrÃ´nica, Keyword: CNPJ, Keyword: Chave de Acesso, Keyword: ICMS, Keyword: CFOP, Keyword: NCM, Pattern: \d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}\s\d{4}
Erro ao registrar AI run: error: invalid input syntax for type integer: "0.95"
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.createAiRun (/home/runner/workspace/server/storage.ts:643:21)
    at async AIMultiProvider.logAiRun (/home/runner/workspace/server/ai-multi-provider.ts:769:7)
    at async AIMultiProvider.analyzeDocument (/home/runner/workspace/server/ai-multi-provider.ts:724:9)
    at async DocumentAnalyzer.analyzeDocument (/home/runner/workspace/server/ai/document-analyzer.ts:82:24)
    at async <anonymous> (/home/runner/workspace/server/routes.ts:276:22) {
  length: 148,
  severity: 'ERROR',
  code: '22P02',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: "unnamed portal parameter $10 = '...'",
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'numutils.c',
  line: '617',
  routine: 'pg_strtoint32_safe'
}
ğŸ¤– IA utilizada: openai
ğŸ¯ ConfianÃ§a: 0.95%
ğŸ’° Custo: $0.516375
â±ï¸ Tempo: 3079ms
ğŸ”„ Mapeando dados IA: {
  "valor": "R$ 1.450,00",
  "fornecedor": "ROBSON PNEUS E AUTOPECAS LTDA",
  "descricao": "ManutenÃ§Ã£o de VeÃ­culos SRJ1 - Compra de 2 Pneus",
  "categoria": "PAGO",
  "centro_custo": "GERAL",
  "documento": "NÂº 645 SÃ©rie 1",
  "confidence": 95
}
âœ… SugestÃµes mapeadas: {
  "amount": "R$ 1.450,00",
  "supplier": "ROBSON PNEUS E AUTOPECAS LTDA",
  "contraparte": "ROBSON PNEUS E AUTOPECAS LTDA",
  "documento": "NÂº 645 SÃ©rie 1",
  "description": "ManutenÃ§Ã£o de VeÃ­culos SRJ1 - Compra de 2 Pneus",
  "dueDate": "",
  "paymentDate": "",
  "category": "PAGO",
  "confidence": {
    "amount": 0.95,
    "supplier": 0.95,
    "description": 0.95,
    "dueDate": 0,
    "paymentDate": 0
  }
}
4:49:48 PM [express] POST /api/documents/process-file 200 in 3630ms :: {"success":true,"ocrText":"DAâ€¦